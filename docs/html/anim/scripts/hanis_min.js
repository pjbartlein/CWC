function PEvs(W,Cd,Dd,Ab,Ed,Fd,Gd){var Ta,F,D,E,ia,z,J,Ga,Bb,Ha,Ua,I,ob,Va,Wa,Na,X,ea=0,Xa=0,ja,v,S=0,fa=!1,f=function(g){Ga=g.target;for(Ha=Bb=0;Ga;)Bb+=Ga.offsetLeft-Ga.scrollLeft,Ha+=Ga.offsetTop-Ga.scrollTop,Ga=Ga.offsetParent;ea=g.pageX-Bb-document.body.scrollLeft;Xa=g.pageY-Ha-document.body.scrollTop};this.getX=function(){return ea};this.getY=function(){return Xa};var u=function(g){f(g);ja=ea;v=Xa;E=!0;null!=Na&&(ia=(new Date).getTime());null!=ob&&ob(g)},$=function(g){f(g);E=!1;null!=I&&I(g);
null!=Na&&(z=(new Date).getTime(),J=z-ia,300>J&&Na(g))},Q=function(g){f(g);3>Math.abs(ea-ja)&&3>Math.abs(Xa-v)||(v=ja=-9999,E?null!=Va&&Va(g):null!=Wa&&Wa(g),null!=X&&P())};this.touchDown=function(g){D=!0;S+=g.changedTouches.length;if(1<S)return fa=!0,g.returnValue=!0;Ta=g.changedTouches;F=Ta[0];u(F)};this.touchUp=function(g){D=!0;S-=g.changedTouches.length;0>S&&(S=0);0==S&&(fa=!1);if(fa)return g.returnValue=!0;g.preventDefault();g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation();
Ta=g.changedTouches;F=Ta[0];$(F)};this.touchMove=function(g){D=!0;if(fa)return g.returnValue=!0;g.preventDefault();g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation();Ta=g.changedTouches;F=Ta[0];Q(F)};this.mouseDown=function(g){D||(g.preventDefault(),g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation(),u(g))};this.clearDown=function(){E=!1};this.mouseUp=function(g){D||(g.preventDefault(),g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation(),
$(g))};this.mouseClick=function(g){g.preventDefault();g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation();E=!1};this.mouseMove=function(g){D||(g.preventDefault(),g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation(),Q(g))};this.mouseDragged=function(g){D||(g.preventDefault(),g.stopImmediatePropagation?g.stopImmediatePropagation():g.stopPropagation(),f(g),null!=Va&&Va(g),null!=X&&P())};var P=function(){clearTimeout(Ua);Ua=setTimeout(function(){X()},600)};
v=ja=Xa=ea=0;ob=Cd;I=Dd;Wa=Ab;Va=Ed;Na=Fd;X=Gd;E=D=!1;W.addEventListener("mousedown",this.mouseDown,!1);W.addEventListener("mouseup",this.mouseUp,!1);W.addEventListener("mousemove",this.mouseMove,!1);W.addEventListener("click",this.mouseClick,!1);W.addEventListener("touchstart",this.touchDown,!1);W.addEventListener("touchend",this.touchUp,!1);W.addEventListener("touchmove",this.touchMove,!1);W.addEventListener("pointerdown",this.mouseDown,!1);W.addEventListener("pointerup",this.mouseUp,!1);W.addEventListener("pointermove",
this.mouseMove,!1);W.addEventListener("contextmenu",function(g){g.preventDefault()},!1);W.addEventListener("touchleave",this.touchUp,!1);W.addEventListener("touchenter",this.touchDown,!1);W.addEventListener("touchcancel",this.touchUp,!1);W.addEventListener("mouseout",function(g){E||(Xa=ea=-1,null!=Wa&&Wa(g));E=!1})};var HAniS=new function(){function W(a,b,e,d,c){this.color=a;this.alpha=1;7<this.color.length&&(this.alpha=parseInt(this.color.substring(7),16)/255,this.color=this.color.substring(0,7),.1>this.alpha&&(this.alpha=.1));this.action=b;this.value=e;this.tip=d;this.poly=c;a=c.split(",");this.xy=[];this.ymin=this.xmin=9999;for(b=this.ymax=this.xmax=0;b<a.length;b++)this.xy[b]=parseInt(a[b].trim(),10),0==b%2?(this.xy[b]<this.xmin&&(this.xmin=this.xy[b]),this.xy[b]>this.xmax&&(this.xmax=this.xy[b])):(this.xy[b]<
this.ymin&&(this.ymin=this.xy[b]),this.xy[b]>this.ymax&&(this.ymax=this.xy[b]));this.height=this.ymax-this.ymin+1;this.width=this.xmax-this.xmin+1;this.can=A("canvas");this.can.height=this.height;this.can.width=this.width;this.ctx=this.can.getContext("2d");this.ctx.imageSmoothingEnabled=!1;this.ctx.fillStyle=this.color;this.ctx.globalAlpha=this.alpha;this.ctx.beginPath();this.ctx.moveTo(this.xy[0]-this.xmin,this.xy[1]-this.ymin);for(b=2;b<this.xy.length;b+=2)this.ctx.lineTo(this.xy[b]-this.xmin,this.xy[b+
1]-this.ymin);this.ctx.closePath();this.ctx.fill()}function Cd(a,b,e,d,c){this.overlay=a;this.color=b;this.action=e;this.value=d;this.tip=c}function Dd(a,b,e,d,c,l,g,h,f){this.x0=a;this.y0=b;this.icon=null;this.isIcon=!1;"icon"==e?(this.icon=new Image,this.icon.hotspot=this,Hd=!0,this.icon.onload=function(a){this.gotit=!0;this.hotspot.x1=this.hotspot.x0+this.width;this.hotspot.y1=this.hotspot.y0+this.height;this.hotspot.width=this.width;this.hotspot.height=this.height;this.hotspot.w2=this.width/2;
this.hotspot.h2=this.height/2;this.hotspot.isIcon=!0},this.y1=this.x1=-1,this.icon.gotit=!1,this.icon.src=d.trim()):(this.width=parseInt(e,10),this.height=parseInt(d,10),this.x1=this.width+a,this.y1=this.height+b,this.w2=this.width/2,this.h2=this.height/2);this.pan=c;this.isPan=!1;"pan"===this.pan&&(this.isPan=!0);this.action=l;this.value=g;this.overlay=h;this.tip=f}function Ab(a,b,e,d,c,l,g){this.bg=a;null!=a&&0==this.bg.indexOf("0x")&&(this.bg="#"+this.bg.substring(2));this.fg=b;null!=b&&0==this.fg.indexOf("0x")&&
(this.fg="#"+this.fg.substring(2));this.font=e;this.fontHeight=Math.round(1.1*parseInt(e,10));this.scolor=d;null!=d&&0==this.scolor.indexOf("0x")&&(this.scolor="#"+this.scolor.substring(2));this.sblur=c;this.sxoff=l;this.syoff=g}function Ed(){var a,b,e,d,c,l,g,h,f=Math.PI/180;this.init=function(e){for(var d=[],h=1;h<e.length;h++)d[h]=parseFloat(e[h]);b=d[1];a=d[4]/d[5];c=d[6];l=d[7];e=this.toXY(d[2],d[3]);c=e[0];l=e[1]};this.toXY=function(h,g){e=a*Fc(g-b)*f-c;d=-a*h*f-l;return[e,d]};this.toLatLon=
function(e,d){g=-(d+l)/a/f;h=Fc((e+c)/a/f+b);return[g,h]}}function Fd(){var a,b,e,d,c,l,g,h,f,gc,n,p,k,m,u,A,C,s,w,v,q,D,t,y,B,r,x,G,F,H,E,z=Math.PI/180;this.init=function(e){for(var d=[],c=1;c<e.length;c++)d[c]=parseFloat(e[c]);a=d[1];b=d[2];v=0==d[8]?!1:!0;q=d[6];D=q*q;t=D*D;y=t*D;B=t*t;g=d[5]/d[7];E=d[7];v?(h=Math.cos(z*a),f=Math.sin(z*a)):(h=Math.cos(-a*z),f=Math.sin(-a*z));C=h/Math.sqrt(1-D*f*f);w=(1-q*f)/(1+q*f);A=v?Math.tan(Math.PI/4-a*z/2)/Math.pow(w,q/2):Math.tan(Math.PI/4- -a*z/2)/Math.pow(w,
q/2);m=d[9];u=d[10];e=this.toXY(d[3],d[4]);m=e[0];u=e[1]};this.toXY=function(h,k){v?(c=z*h,l=z*(k-b)):(c=z*-h,l=z*(b-k));w=(1-q*Math.sin(c))/(1+q*Math.sin(c));s=Math.tan(Math.PI/4-c/2)/Math.pow(w,q/2);r=90!=a&&-90!=a?g*C*s/A:2*g*E*s/Math.sqrt(Math.pow(1+q,1+q)*Math.pow(1-q,1-q));e=r*Math.sin(l);d=r*Math.cos(l);v||(e=-e,d=-d);gc=e-m;n=d-u;return[gc,n]};this.toLatLon=function(l,h){e=l+m;d=h+u;r=Math.sqrt(e*e+d*d);s=90==a||-90==a?r*Math.sqrt(Math.pow(1+q,1+q)*Math.pow(1-q,1-q))/(2*g*E):r*A/(g*C);x=Math.PI/
2-2*Math.atan(s);G=Math.sin(2*x);F=Math.sin(4*x);H=Math.sin(6*x);c=x+G*D/2+5*G*t/24+G*y/12+13*G*B/360+7*F*t/48+29*F*y/240+811*F*B/11520+7*H*y/120+81*H*B/1120+4279*Math.sin(8*x)*B/161280;v?(p=c/z,k=Math.atan2(e,d)/z+b):(p=-c/z,k=-Math.atan2(-e,-d)/z+b);return[p,Fc(k)]}}function Gd(){var a,b,e,d,c,l,g,h,f,m,n,p,k,q,u,A,v,s,w,C,z,D,t,r,x,B,G,y,F,H,E,L,K,O,J,I=Math.PI/180;this.init=function(d){for(var c=[],l=1;l<d.length;l++)c[l]=parseFloat(d[l]);a=c[1];b=c[2];e=c[3];r=c[7];x=r*r;B=x*x;G=B*x;y=B*B;h=
c[6]/c[8];f=Math.cos(I*a);m=Math.cos(I*b);p=Math.sin(a*I);n=Math.sin(b*I);z=f/Math.sqrt(1-x*p*p);D=m/Math.sqrt(1-x*n*n);w=Math.sqrt((1-p)/(1+p)*Math.pow((1+r*p)/(1-r*p),r));C=Math.sqrt((1-n)/(1+n)*Math.pow((1+r*n)/(1-r*n),r));E=(Math.log(z)-Math.log(D))/(Math.log(w)-Math.log(C));L=z/(E*Math.pow(w,E));O=h*L*Math.pow(w,E);v=c[9];s=c[10];d=this.toXY(c[4],c[5]);v=d[0];s=d[1]};this.toXY=function(a,b){l=I*a;g=I*Fc(b-e);J=Math.sin(l);t=Math.sqrt((1-J)/(1+J)*Math.pow((1+r*J)/(1-r*J),r));H=h*L*Math.pow(t,
E);K=E*g;d=H*Math.sin(K);c=O+H*Math.cos(K);k=d-v;q=c-s;return[k,q]};this.toLatLon=function(a,b){d=a+v;c=b+s;H=Math.abs(E)/E*Math.sqrt(d*d+(O-c)*(O-c));t=Math.pow(H/(h*L),1/E);F=Math.PI/2-2*Math.atan(t);K=0>E?Math.atan(-d/(c-O)):Math.atan(d/(O-c));g=K/E;l=F+(x/2+5/24*B+G/12+13/360*y)*Math.sin(2*F)+(7/48*B+29/240*G+811/11520*y)*Math.sin(6*F)+(7/120*G+81/1120*y)*Math.sin(6*F)+4279/161280*y*Math.sin(8*F);u=l/I;A=Fc(e-g/I);return[u,A]}}var Ta,F,D,E,ia,z,J,Ga,Bb,Ha,Ua,I,ob,Va,Wa,Na,X,ea,Xa,ja,v,S,fa,f,
u,$,Q,P,g,Cb,Ya,Gc,L,Id,pa,T,q,Hc,hc,Oa,Jd,Kd,Ld,Ub,M,N,s,w,aa,ba,qa,ca,H,B,Je,Za,pb,C,Db,ic,jc,Ic,c,ka,$a,Eb,hd,Md,Ke,id,la,Vb,Fb,qb,ma,ab,Gb,kc,jd,Jc,lc,Wb,Kc,Lc,rb,Nd,Od,Pd,Qd,Rd,Hb,bb,Hd,kd,Sd,va,ga,t,ld,na,mc,cb,md,nd,nc,V,od,sb,Xb,wa,da,db,tb,eb,ub,oc,xa,Ia,Td,Mc,Nc,Oc,Ud,pd,Yb,Z,Ib,Jb,Pa,fb,gb,Pc,ra,sa,oa,Qa,Ja,Zb,Vd,Wd,Xd,Le,vb,pc,Qc,qc,Yd,rc,qd,Zd,rd,$b,r,Rc,ya,Sc,$d,wb,sc,tc,ac,ae,be,Tc,sd,Ka,ce,uc,x,G,td,Uc,xb,vc,Vc,za,Ra,ud,Wc,de,ta,hb,Xc,Yc,ee,Zc,fe,Me,Ne,ge,wc,xc,Oe,he,Kb,Lb,$c,ie,je,
ib,Mb,vd,ke,le,me,jb,yc,Pe,ne,oe,Qe,Re,ha,Nb,kb,R,zc,La,pe,qe,re,Ac,Ob,wd,yb,Pb,Qb,lb,bc,ad,Se,se,Bc,xd,te,ue,cc,Te,Ue,zb,ve,yd,we,xe,mb,y,ye,Aa,m,Rb,Ba,Ca,Da,bd,zd,ze,Ve,Cc,Ad,Sb,Bd,Ae,cd,dd,Ma,Tb,dc,Be,ed,Ce,Dc,Sa,df="N NNE NE ENE E ESE SE SSE S SSW SW WSW W WNW NW NNW N".split(" "),ef=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,10)},A=function(a){return document.createElement(a)},Y=function(a,
b){return 0==a.trim().toLowerCase().indexOf(b)};this.setup=function(a,b){void 0==b&&(b="MORdivcan");X=document.getElementById(b);Dc="center";X.align=Dc;ea=A("div");ea.setAttribute("style","position:relative;border:0px;margin:0px;padding:0px;-webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; -webkit-tap-heightlight-color:transparent;");ja=A("canvas");ja.setAttribute("style","position:absolute;top:0;left:0;z-index:1;");fa=A("canvas");fa.setAttribute("style","position:absolute;top:0;left:0;z-index:2;");
f=fa.getContext("2d");f.imageSmoothingEnabled=!1;ea.appendChild(ja);ea.appendChild(fa);X.appendChild(ea);I=new PEvs(fa,HAniS.down,HAniS.up,HAniS.move,HAniS.drag,null,HAniS.canTip);X.setAttribute("tabindex",0);X.addEventListener("keydown",function(a){37==a.keyCode?(Ea(!1),fd(-1),ua()):39==a.keyCode?(Ea(!1),fd(1),ua()):82==a.keyCode&&a.altKey&&HAniS.resetZoom()},!0);C=0;ic=!1;Db=1;pb=Za=!0;Q=u=0;Ic=!0;Cb=null;jc=!0;ka=500;$a=100;Eb=2E3;hd=30;Md=0;Ad=6E4;Sb=null;Cc=!1;Id=Gc=Sa=L=null;Uc=td=G=x=1;Vc=
!1;B=H=ca=qa=ba=aa=w=s=N=M=0;Mc=!1;va=0;Hd=!1;Ia=null;dd=cd=Ma=Tb=0;Oa=kd=pd=!1;Xc=Yc=wc=xc=0;Mb=Kb=hb=!1;jb=null;yc=[0,0];cb=de=Zc=!1;Xb=!0;V=sb=null;Ob=wd=od=!1;we=[1,0,0];xe=[2,2,1];mb=[];Ac=[];Fb=Vb=sa=!1;Sc=Rc=0;var e=A("canvas");e.height=1;e.width=1;S=e.getContext("2d");S.imageSmoothingEnabled=!1;nd=A("canvas");ob=!1;"string"===typeof a?0>a.indexOf("\n")?ff(a):De(a.split("\n")):De(a)};var De=function(a){var b,e,d,U;Yb=!0;if(a instanceof Array)for(c={},b=0;b<a.length;b++)2>a[b].length||(e=a[b].trim(),
0!=e.indexOf("#")&&(d=e.indexOf("="),1>d||(U=e.substr(0,d).trim().toLowerCase(),c[U]=e.substr(d+1).trim())));else c=a;ob=!1;null!=c.debug&&("true"==c.debug?(Wa=window.open("","HAniSDebugInfo","scrollbars=yes,width=400,height=200"),ob=!0,O("HAniS Version 3.0")):ob=!1);O("Is type of param an array = "+(a instanceof Array));null!=c.divalign&&(Dc=c.divalign.trim(),X.align=Dc);null!=c.coordinates&&We(c.coordinates);b="green";e="white";d="12px Arial";U=null;var l=10,f=10,h=10;vd=2;ke="Lat = ";le=" Lon = ";
null!=c.coordinates_display_style&&(a=c.coordinates_display_style.split(","),b=a[0].trim(),e=a[1].trim(),d=a[2].trim(),3<a.length&&(ke=a[3],le=a[4],vd=parseInt(a[5],10),6<a.length&&(U=a[6].trim(),l=parseInt(a[7],10),f=parseInt(a[8],10),h=parseInt(a[9],10))));me=new Ab(b,e,d,U,l,f,h);$c=Lb=null;null!=c.map_scale&&(Zc=hb=!0,a=c.map_scale.split(","),Lb=parseFloat(a[0]),$c=1<a.length?parseFloat(a[1]):Lb);ie=" ";null!=c.distance_unit&&(ie=c.distance_unit.trim());Xa=" ";null!=c.divcan_style&&(Xa=c.divcan_style.trim());
null!=c.imagecan_style&&(a=c.imagecan_style.trim()+";position:absolute;top:0;left:0;",ja.setAttribute("style",a+"z-index:1;"),fa.setAttribute("style",a+"z-index:2;"));b="blue";e="white";d="12px Arial";U=null;h=f=l=10;ee=1;he="white";null!=c.distance_display_style&&(a=c.distance_display_style.split(","),b=a[0].trim(),e=a[1].trim(),he=5<=a.length?a[4].trim():e,d=a[2].trim(),ee=parseInt(a[3],10),5<a.length&&(U=a[5].trim(),l=parseInt(a[6],10),f=parseInt(a[7],10),h=parseInt(a[8],10)));Oe=new Ab(b,e,d,
U,l,f,h);b="black";e="white";d="12px Arial";U=null;h=f=l=10;null!=c.probe_display_style&&(a=c.probe_display_style.split(","),b=a[0].trim(),e=a[1].trim(),d=a[2].trim(),3<a.length&&(U=a[3].trim(),l=parseInt(a[4],10),f=parseInt(a[5],10),h=parseInt(a[6],10)));Se=new Ab(b,e,d,U,l,f,h);null!=c.pause&&(Md=parseInt(c.pause,10));null!=c.auto_refresh&&(Ad=6E4*parseInt(c.auto_refresh,10),Sb=setInterval("HAniS.reloadFOF();",Ad),Cc=!0);id=!1;null!=c.enable_smoothing&&Y(c.enable_smoothing,"t")&&(id=!0);null!=c.overlay_labels&&
(g=c.overlay_labels.split(","));Fb=!1;qb=-1;null!=c.overlay_enhance&&(Fb=!0,qb=parseInt(c.overlay_enhance,10)-1);sb=null;Xb=!0;if(null!=c.overlay_allow_hoverzones)for(a=c.overlay_allow_hoverzones.split(","),sb=Array(a.length),b=0;b<a.length;b++)if(sb[b]=!0,Y(a[b],"n")||Y(a[b],"f"))sb[b]=!1;D=F=null;Ta=!1;null!=c.window_size&&(a=c.window_size.split(","),D=parseInt(a[0],10),F=parseInt(a[1],10),Ta=!0);Pc=null;if(null!=c.overlay_spacer)for(a=c.overlay_spacer.split(","),Pc=Array(a.length),b=0;b<a.length;b++)Pc[b]=
parseInt(a[b],10);if(null!=c.overlay_probe_table)for(a=c.overlay_probe_table.split(","),b=0;b<a.length;b++)Ac[b]=parseInt(a[b],10)-1;Cb=null;if(null!=c.overlay_order)for(a=c.overlay_order.split(","),Cb=Array(a.length),b=0;b<a.length;b++)Cb[parseInt(a[b],10)-1]=b;Ya=null;if(null!=c.overlay_links)for(a=c.overlay_links.split(","),Ya=Array(a.length),b=0;b<a.length;b++)Ya[b]=parseInt(a[b],10);Ub=null;if(null!=c.overlay_clear)for(a=c.overlay_clear.split(","),Ub=Array(a.length),b=0;b<a.length;b++)Ub[b]=
a[b].trim().toLowerCase();Hc=null;if(null!=c.overlay_transparent_amount)for(a=c.overlay_transparent_amount.split(","),Hc=Array(a.length),b=0;b<a.length;b++)Hc[b]=parseFloat(a[b])/100;Nb=null;if(null!=g&&null!=c.overlay_zoom)for(a=c.overlay_zoom.split(","),Nb=Array(a.length),b=0;b<a.length;b++)if(Nb[b]=1,Y(a[b],"n")||Y(a[b],"f"))Nb[b]=0;else if(Y(a[b],"d")||Y(a[b],"h"))Nb[b]=-1;kb=null;if(null!=g&&null!=c.overlay_preserve_list)for(a=c.overlay_preserve_list.split(","),kb=Array(a.length),b=0;b<a.length;b++)if(kb[b]=
!0,Y(a[b],"n")||Y(a[b],"f"))kb[b]=!1;Sc=0;$d=" ";wb="white";sc="transparent";tc="14pt arial";ae=!1;null!=c.times_label_style&&(a=c.times_label_style.split(","),wb=a[0].trim(),1<a.length&&(Sc=Math.floor(60*parseFloat(a[1]))),1<a.length&&(Sc="?"==a[1].trim()||"auto"==a[1].trim().toLowerCase()?-Math.floor((new Date).getTimezoneOffset()):Math.floor(60*parseFloat(a[1]))),2<a.length&&($d=a[2].trim()),3<a.length&&(sc=a[3].trim()),4<a.length&&(tc=a[4].trim()),5<a.length&&-1!=a[5].trim().indexOf("t")&&(ae=
!0));0==wb.indexOf("0x")&&(wb="#"+wb.substring(2));0==sc.indexOf("0x")&&(sc="#"+sc.substring(2));ac=parseInt(tc,10);Le=new Ab("black","white",tc,"black",20,5,5);be=!1;null!=c.to_from_lock&&(be=Y(c.to_from_lock,"t")?!0:!1);b="black";e="white";d="14px arial";U=null;h=f=l=10;te=ue=" ";xd=cc=null;null!=c.dirspd_display_style&&(a=c.dirspd_display_style.split(","),b=a[0].trim(),e=a[1].trim(),d=a[2].trim(),te=a[3],ue=a[4],5<a.length&&(U=a[5].trim(),l=parseInt(a[6],10),f=parseInt(a[7],10),h=parseInt(a[8],
10)),xd=new Ab(b,e,d,U,l,f,h));b="black";e="white";d="14px arial";U=null;h=f=l=10;null!=c.tipbox_display_style&&(a=c.tipbox_display_style.split(","),b=a[0].trim(),e=a[1].trim(),d=a[2].trim(),3<a.length&&(U=a[3].trim(),l=parseInt(a[4],10),f=parseInt(a[5],10),h=parseInt(a[6],10)));je=new Ab(b,e,d,U,l,f,h);R=null;if(null!=g&&null!=kb)for(a=c.overlay_preserve.split(","),R=Array(kb.length),b=d=0;b<kb.length;b++)if(kb[b]){R[b]=Array(4);for(e=0;4>e;e++)R[b][e]=parseInt(a[d].trim(),10),d+=1;R[b][2]=R[b][2]-
R[b][0]+1;R[b][3]=R[b][3]-R[b][1]+1}Gc=null;L=c.image_base;null!=L?Gc=L=L.trim():L=null!=c.image_only_base?c.image_only_base.trim():null;Id=L;Sa=c.overlay_base;null!=Sa&&(Sa=c.overlay_base.trim());Yb=!0;if(null!=c.filenames){a=c.filenames.split(",");u=a.length;$=Array(u);for(b=0;b<u;b++)$[b]=null!=L?L+a[b].trim():a[b].trim();Yb=!1;Q=0}if(null!=c.basename){a=c.basename;null!=L&&(a=L+c.basename);e=c.base_starting_number;null==e&&(e=0);u=c.num_frames;null==u&&(u=c.num_images);u=parseInt(u,10);$=Array(u);
for(b=0;b<u;b++){d=b+parseInt(e,10);if(0<=a.indexOf("*"))$[b]=a.replace("*",d);else if(0<=a.indexOf("?")){for(U=a;0<=U.lastIndexOf("?");)l=U.lastIndexOf("?"),U=U.substring(0,l)+d%10+U.substring(l+1),d=Math.floor(d/10);$[b]=U}else $[b]=a+b;O("image filename = "+$[b])}null!=c.reverse_order&&Y(c.reverse_order,"t")&&$.reverse();Yb=!1;Q=0}kd=!0;a=c.background_static;null!=a&&(Y(a,"f")||Y(a,"n"))&&(kd=!1);if(null!=c.overlay_filenames){a=c.overlay_filenames.split(",");P=Array(u);for(b=0;b<a.length;b++)for(d=
a[b].split("&"),Q=a.length,e=0;e<u;e++)0==b&&(P[e]=Array(Q)),P[e][b]=d[e].trim(),null!=Sa?P[e][b]=(Sa+P[e][b]).trim():null!=L&&(P[e][b]=(L+P[e][b]).trim());Yb=!1}ha=null;if(null!=c.image_preserve)for(a=c.image_preserve.split(","),ha=[],b=0;b<a.length;b++)ha[b]=parseInt(a[b].trim(),10),1<b%4&&(ha[b]=ha[b]-ha[b-2]+1);ce=!0;null!=c.keep_zoom&&Y(c.keep_zoom,"f")&&(ce=!1);dc=Be=0;null!=c.hide_bottom&&(Be=parseInt(c.hide_bottom.trim(),10));ed=Ce=0;null!=c.hide_top&&(Ce=parseInt(c.hide_top.trim(),10));pe=
"<div>";re=300;qe=500;null!=c.popup_style&&(a=c.popup_style,pe='<div style="'+c.popup_style+'">');null!=c.popup_window_size&&(a=c.popup_window_size.split(","),qe=a[0],re=a[1]);xb=!1;null!=c.active_zoom&&Y(c.active_zoom,"t")&&(xb=!0);uc=1;null!=c.zoom_scale&&(uc=parseFloat(c.zoom_scale));vc=9999999;null!=c.maximum_zoom&&(vc=parseFloat(c.maximum_zoom));Bd=!0;null!=c.use_progress_bar&&Y(c.use_progress_bar,"f")&&(Bd=!1);null!=c.dwell?(a=c.dwell.split(","),ka=parseInt(a[0].trim(),10),1<a.length&&($a=parseInt(a[1].trim(),
10),10>$a&&($a=10),Eb=parseInt(a[2].trim(),10),hd=parseInt(a[3].trim(),10))):null!=c.rate&&(a=c.rate.split(","),ka=Math.round(1E4/parseFloat(a[0].trim())),1<a.length&&($a=Math.round(1E4/parseFloat(a[2].trim())),10>$a&&($a=10),Eb=Math.round(1E4/parseFloat(a[1].trim()))));vb=null;if(null!=c.times){a=c.times.split(",");vb=Array(a.length);for(b=0;b<a.length;b++)vb[b]=parseInt(a[b].trim(),10);Xe(vb)}rc=null;null!=c.extrap_times_template&&(rc=RegExp(c.extrap_times_template));Wd=["Click on target's initial position",
"Click on target's final position","Move pointer around or click here to select target"];null!=c.extrap_prompts&&(Wd=c.extrap_prompts.split(","));if(null!=c.probe_table){a=new XMLHttpRequest;Aa=[];ze=[];Pb=[];var q=" ";Qb=[];var gc="Value=";lb=[];var n=1;Rb=[];zd=[];Ba=[];Ca=[];Da=[];var p,k=-1;m=-1;var r=0;a.onload=function(){for(var a=this.responseText.split("\n"),b=0;b<a.length;b++)if(!(2>a[b].length)){var d=a[b].replace(/\s+/g," ").trim().split(","),e=d[0].split(" ");if(0==e[0].indexOf("*"))m++,
Aa[m]=[],Qb[m]=[],Pb[m]=[],lb[m]=[],Ba[m]=[],Ca[m]=[],Da[m]=[],zd[m]=[],Rb[m]=[],k=-1,ze[m]=1<d.length?d[1].trim():"None",r=1;else if(0!=r){k++;var c=Array(3);Aa[m][k]=parseFloat(e[0]);Ba[m][k]=parseInt(e[1].trim(),10);Ca[m][k]=parseInt(e[2].trim(),10);Da[m][k]=parseInt(e[3].trim(),10);0!=k&&(c[0]=Ba[m][k]-Ba[m][k-1],c[1]=Ca[m][k]-Ca[m][k-1],c[2]=Da[m][k]-Da[m][k-1],p=0,Math.abs(c[1])>Math.abs(c[p])&&(p=1),Math.abs(c[2])>Math.abs(c[p])&&(p=2),zd[m][k-1]=p,Rb[m][k-1]=c,0==Rb[m][k-1][p]&&(Rb[m][k-1][p]=
1));1<d.length&&(0==d[1].trim().indexOf('"')?(n=-1,d=d[1].trim(),gc=d.substr(1,d.length-2),q=""):(n=parseInt(d[1],10),2<d.length&&(q=d[2].trim()),3<d.length&&(gc=d[3].trim())));Qb[m][k]=gc;lb[m][k]=n;Pb[m][k]=q}}};a.open("get",c.probe_table,!0);a.send()}Ga=c.controls;O("controls = "+c.controls);O("bottom_controls = "+c.bottom_controls);La=zc=gb=fb=Jb=Ib=Z=null;null!=Ga&&Ye(Ga,!0);Bb=c.bottom_controls;null!=Bb&&Ye(Bb,!1);Yb?HAniS.getFOF():(jc=!0,Ee())},We=function(a){a=a.split(",");"PS"===a[0]?(jb=
new Fd,jb.init(a)):"CE"==a[0]?(jb=new Ed,jb.init(a)):"LCC"==a[0]?(jb=new Gd,jb.init(a)):(jb=null,ne=parseFloat(a[0]),oe=parseFloat(a[1]),Qe=parseFloat(a[2]),Re=parseFloat(a[3]))},ff=function(a){var b=new XMLHttpRequest;b.onload=function(){De(this.responseText.split("\n"))};b.open("get",a+"?"+Math.round(1E5*Math.random()),!0);b.send()},Ze=function(a){var b;if(null!=Ub){for(b=0;b<Ub.length;b++)-1!=Ub[b].indexOf(a)&&(q[b].checked=!1);for(b=0;b<Ub.length;b++)Fe(b)}},Xe=function(a){var b=0;qd=Array(a.length);
for(var e=0;e<a.length;e++){var d=60*Math.floor(a[e]/100)+Math.floor(a[e])%100;0==e&&(ya=d);b=d-ya;0>b&&(b=d+1440-ya);qd[e]=b;O("times s="+d+"  min="+qd[e])}ya+=Sc;1440<=ya&&(ya-=1440);0>ya&&(ya+=1440);O("Starting minute = "+ya)},$e=function(a,b){if(0!=a)for(var e=0;e<a;e++)0==q[ga[e].overlay].isGhost&&(q[ga[e].overlay].parentNode.style.visibility=b)};this.reloadFOF=function(){O("reload FoF = "+Sb);Ze("r");Yb?HAniS.newFOF(Ve):(jc=!0,Ee())};this.getFOF=function(){var a=c.file_of_filenames.trim();HAniS.newFOF(null!=
Gc?Gc+a:a)};this.newFOF=function(a){var b,e,d,c,l,f=new XMLHttpRequest,h,g,q,n,p,k;Sd=va;var m=null;pd=!1;pb=Za;Ea(!1);va=u=0;$=[];Hb=null;bb=0;na=null;mc=0;cb=md=!1;wa=null;oc=!1;da=-1;ub=eb=tb=db=null;Td=-1;P=[];var r=!1;if(null==vb||null!=rc)vb=[];O("new FOF="+a);sa&&(null!=ra&&(ra.innerHTML=ra.label_on,X.style.cursor="default",Ea(pb),oa=-1),sa=!1,Fa());f.onload=function(){var a=this.responseText.split("\n");for(b=0;b<a.length;b++)if(!(2>a[b].length)&&(h=a[b].trim(),O("FOF: "+h),0!=h.indexOf("#")))if(0==
h.indexOf("fof_extension"))p=h.split("="),m=p[1].trim();else if(0==h.indexOf("image_base"))p=h.split("="),L=p[1].trim();else if(0==h.indexOf("overlay_base"))p=h.split("="),Sa=p[1].trim();else if(0==h.indexOf("high_res_basemap")){p=h.split("=");k=p[1].split(",");tb=[];for(e=0;e<k.length;e++)tb[e]=k[e].trim(),null!=L&&(tb[e]=L+tb[e]);oc=!0}else if(0==h.indexOf("high_res_overlay")){p=h.split("=");k=p[1].split(",");Td=parseInt(k[0].trim(),10)-1;ub=[];for(e=1;e<k.length;e++)ub[e-1]=k[e].trim(),null!=Sa?
ub[e-1]=Sa+ub[e-1]:null!=L&&(ub[e-1]=L+ub[e-1]);oc=!0}else if(0==h.indexOf("high_res_zoom")){p=h.split("=");k=p[1].split(",");wa=[];for(e=0;e<k.length;e++)wa[e]=parseFloat(k[e].trim());Ge()}else if(0==h.indexOf("hoverzone"))gf(h);else if(0==h.indexOf("hotzone"))af(h);else if(0==h.indexOf("hotspot"))hf(h);else if(0==h.indexOf("toggle_onoff"))p=h.split("="),Nc=p[1].split(",");else if(0==h.indexOf("coordinates"))p=h.split("="),We(p[1]);else if(0==h.indexOf("map_scale"))p=h.split("="),k=p[1].split(","),
Lb=parseFloat(k[0]),$c=1<k.length?parseFloat(k[1]):Lb;else if(0==h.indexOf("times")){p=h.split("=");k=p[1].split(",");for(b=0;b<k.length;b++)vb[b]=parseInt(k[b].trim(),10);r=!0}else{if(null!=rc){var f=h.match(rc);null!=f&&2==f.length?(vb.push(parseInt(f[1],10)),O("+ + + Extrap time = "+f[1]),r=!0):O("+ + + Cannot parse times using "+rc+" from line: "+h)}d=h.indexOf(" ");0>d&&(d=h.length);$[u]=h.substring(0,d).trim();null!=L&&($[u]=L+$[u]);h=h.substring(d+1);c=h.indexOf('"');0<=c&&(null==xa&&(xa=[]),
d=h.substring(c+1),c=d.indexOf('"'),0<=c&&(xa[u]=d.substring(0,c),0==u&&(Ia.innerHTML=xa[0])));P[u]=[];c=h.indexOf("overlay");if(0<=c)for(g=h.substring(c),c=g.indexOf("="),0>c&&O("Cannot find a = sign in "+g),q=g.substring(c+1),g=q.trim(),q=g.split(","),Q=q.length,O("numOverlays set to "+Q),l=0;l<q.length;l++)P[u][l]=q[l].trim(),null!=Sa?P[u][l]=(Sa+P[u][l]).trim():null!=L&&(P[u][l]=(L+P[u][l]).trim());u+=1}r&&Xe(vb);null!=m?(a=new XMLHttpRequest,a.onload=function(){var a=this.responseText.split("\n");
for(b=0;b<a.length;b++)2>a[b].length||(n=a[b].trim(),O("ext_FOF: "+n),0!=n.indexOf("#")&&0==n.indexOf("hotzone")&&af(n));He()},a.onerror=function(){He()},a.open("get",m+"?"+Math.round(1E5*Math.random()),!0),a.send()):He()};Ve=a;f.open("get",a+"?"+Math.round(1E5*Math.random()),!0);f.send()};var He=function(){0!=va?$e(va,"visible"):0!=Sd&&$e(Sd,"hidden");jc=!0;Ee()},Ee=function(){var a,b,e,d="?"+Math.round(1E4*Math.random());pa=Array(u);Tb=Ma=0;Ae=Bd;de&&(Ra.max=u-1);Ic&&(Vb||Fb)&&(ab=[],ma=[],Gb=[],
jd=[],Jc=[]);null!=la&&(la.selectedIndex=0);for(a=0;a<u;a++){Ic&&(Vb||Fb)&&(ab[a]=A("canvas"),ma[a]=A("canvas"));pa[a]=new Image;pa[a].gotit=!1;pa[a].frameNum=a;pa[a].onerror=function(){Ma++};pa[a].onload=function(){Ic&&(Ic=!1,E=this.height,ia=this.width,ca=E,qa=ia,Ta?(ja.height=F,ja.width=D,fa.height=F,fa.width=D):(ja.height=ca,ja.width=qa,fa.height=ca,D=fa.width=qa,F=ca),cd=D/2-100,dd=F/2-10,z=1*qa/D,J=1*ca/F,ea.setAttribute("style","position:relative;border:0px;margin:0px;padding:0px;-webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; -webkit-tap-heightlight-color:transparent;"+
Xa+"height:"+F+"px;width:"+D+"px;"));if(0<mc&&!md){nd.height=E;nd.width=ia;nc=nd.getContext("2d");nc.clearRect(0,0,D,F);for(var a=0;a<na.length;a++){for(var c=na[a].ctx.getImageData(0,0,na[a].width,na[a].height).data,h=nc.getImageData(na[a].xmin,na[a].ymin,na[a].width,na[a].height),g=3;g<c.length;g+=4)0!=c[g]&&(h.data[g]=a+1);nc.putImageData(h,na[a].xmin,na[a].ymin)}xb||(cb=!0);md=!0}if(jc){jc=!1;v=ja.getContext("2d");v.imageSmoothingEnabled=id;v.fillStyle="blue";v.font="bold 20px Arial";f=fa.getContext("2d");
f.imageSmoothingEnabled=id;lc=Array(u);Mc&&jf(u);if(0<Q)for(T=Array(u),e=0;e<u;e++)for(T[e]=Array(Q),b=0;b<Q;b++)T[e][b]=new Image,T[e][b].gotit=!1,T[e][b].frameNum=e,T[e][b].overlayNum=b,T[e][b].onerror=function(){Ma++},T[e][b].onload=function(){this.gotit=!0;Ma++;gd();if(this.height!=E||this.width!=ia)this.gotit=!1,O("Bad image size:"+this.src);if(Fb&&this.gotit&&this.overlayNum==qb){var a=this.frameNum;ab[a].height=this.height;ab[a].width=this.width;kc=ab[a].getContext("2d");kc.drawImage(this,
0,0);jd[a]=kc.getImageData(0,0,this.width,this.height).data;ma[a].height=this.height;ma[a].width=this.width;Gb[a]=ma[a].getContext("2d");Gb[a].drawImage(this,0,0);Jc[a]=Gb[a].getImageData(0,0,this.width,this.height);T[a][this.overlayNum]=null;T[a][this.overlayNum]=ma[a];T[a][this.overlayNum].gotit=!0}},a=P[e][b],void 0==hc||hc[b]||(a=P[e][b]+d),T[e][b].src=a,Tb++;if(null!=tb)for(db=[],b=0;b<tb.length;b++)db[b]=new Image,db[b].gotit=!1,db[b].onerror=function(a){Ma++},db[b].onload=function(a){a.currentTarget.gotit=
!0;Ma++;gd()},db[b].src=tb[b],Tb++;if(null!=ub)for(eb=[],b=0;b<tb.length;b++)eb[b]=new Image,eb[b].gotit=!1,eb[b].onerror=function(a){Ma++},eb[b].onload=function(a){a.currentTarget.gotit=!0;Ma++;gd()},eb[b].src=ub[b],Tb++}this.height==E&&this.width==ia?this.gotit=!0:(this.gotit=!1,O("Image has invalid size:"+this.src));Vb&&this.gotit&&(a=this.frameNum,ab[a].height=this.height,ab[a].width=this.width,kc=ab[a].getContext("2d"),kc.drawImage(this,0,0),jd[a]=kc.getImageData(0,0,this.width,this.height).data,
ma[a].height=this.height,ma[a].width=this.width,Gb[a]=ma[a].getContext("2d"),Gb[a].drawImage(this,0,0),Jc[a]=Gb[a].getImageData(0,0,this.width,this.height),pa[a]=null,pa[a]=ma[a],pa[a].gotit=!0);Ma++;gd();ce||HAniS.resetZoom();pd=!0;Je||(Je=!0,Za=!1,bf());Ea(pb)};var c=$[a];kd||(c=$[a]+d);pa[a].src=c;Tb++}Kb=Oa=!1;Fa()},nb=function(a,b,e,d,f){a.label_on=e;a.label_off=d;e=null;d=c[b+"_labels"];null==d&&(d=c[b+"_label"]);null!=d&&(d=d.split(","),a.label_on=d[0].trim(),1<d.length&&(a.label_off=d[1].trim()),
2<d.length&&(e="width:"+d[2].trim()+"px;"));null!=f&&(a.title=f);a.innerHTML=a.label_on;b=(null!=e?e:"")+Na+c[b+"_style"];null!=b&&a.setAttribute("style",b)},Ye=function(a,b){var e,d,f,l;Na=c.buttons_style;var r=null,h=null,r=b?c.controls_tooltip:c.bottom_controls_tooltip,v=a.split(",");null!=r&&(f=r.split(","),f.length!=v.length&&(O("!!! Number of tooltips must equal number of controls!"),f=r=null));var s=null,n;for(e=0;e<v.length;e++){n=null!=r?f[e]:null;var p=v[e].trim(),k=p.indexOf("/");if(0===
k||0===e)0===k&&(p=p.substring(1)),l=A("div"),l.align=Dc,null!=c.controls_style?l.setAttribute("style",c.controls_style):l.setAttribute("style","position:relative;padding:2px;width:100%;"),b?X.insertBefore(l,ea):(null!=c.bottom_controls_style&&l.setAttribute("style",c.bottom_controls_style),X.appendChild(l));k=c.enhance_filename;null==k&&(k=c.enhance_table);if("enhance"==p.trim()&&null!=k){la=A("select");h=c.enhance_style;null!=h&&la.setAttribute("style",h);null!=n&&(la.title=n);h=A("option");h.innerHTML=
"Pick Enhancement";h.value=-1;la.add(h);la.addEventListener("change",HAniS.doEnhance,!1);Vb=!Fb;la.disabled=Vb?!1:!0;l.appendChild(la);h=new XMLHttpRequest;Aa=[];Pb=[];Qb=[];lb=[];var w,x,z;Ba=[];Ca=[];Da=[];bd=[];m=-1;var B=!1,t,D,y,E,G,F,H,I,L,J,S,Q,T;h.onload=function(){for(var a=this.responseText.split("\n"),b=0;b<a.length;b++)if(!(2>a[b].length)){var d=a[b].replace(/\s+/g," ").trim(),e=d.indexOf("#");if(0!=e)if(0<e&&(d=d.substring(0,e)),0==d.indexOf("*"))m++,Aa[m]=Array(256),Qb[m]=Array(256),
Pb[m]=Array(256),lb[m]=Array(256),Ba[m]=Array(256),Ca[m]=Array(256),Da[m]=Array(256),bd[m]=Array(256),Aa[m]=Array(256),w=" ",x="Value =",z=1,e=A("option"),e.innerHTML=d.substring(1),e.value=m,la.add(e);else{var c=d.indexOf("value");0>c&&(c=d.indexOf("probe"));B=!1;J=S=0;0<c&&(e=d.substring(c+1),d=d.substring(0,c),c=e.indexOf("="),e=e.substring(c+1),e=e.split(","),1==e.length?(x=e[0].trim(),z=-1,B=!1):(J=parseFloat(e[0].trim()),S=parseFloat(e[1].trim()),2<e.length&&(z=parseInt(e[2],10)),3<e.length&&
(w=e[3].trim()),4<e.length&&(x=e[4].trim()),B=!0));d=d.split(" ");t=parseInt(d[0].trim(),10);D=parseInt(d[1].trim(),10);y=D-t;E=parseFloat(d[2].trim());G=parseFloat(d[3].trim());F=parseFloat(d[4].trim());H=parseFloat(d[5].trim());I=parseFloat(d[6].trim());L=parseFloat(d[7].trim());Q=T=255;9<d.length&&(Q=parseFloat(d[8].trim()),T=parseFloat(d[9].trim()));for(d=t;d<=D;d++)0==y?(Ba[m][t]=E,Ca[m][t]=F,Da[m][t]=I,bd[m][t]=Q):(Ba[m][d]=Math.round(E+(G-E)*(d-t)/y),Ca[m][d]=Math.round(F+(H-F)*(d-t)/y),Da[m][d]=
Math.round(I+(L-I)*(d-t)/y),bd[m][d]=Math.round(Q+(T-Q)*(d-t)/y)),Qb[m][d]=x,Pb[m][d]=w,lb[m][d]=z,B&&(Aa[m][d]=J+(S-J)*(d-t)/y)}}};h.open("get",k,!0);h.send()}"startstop"==p&&(Z=A("button"),Z.className="startstop start",nb(Z,"startstop","Start","Stop",n),Z.addEventListener("click",HAniS.toggleIsLooping,!1),l.appendChild(Z));pb=!0;null!=c.start_looping&&Y(c.start_looping,"f")&&(pb=!1);Ea(pb);"looprock"==p&&(za=A("button"),za.className="looprock rock",nb(za,"looprock","Rock","Loop",n),Db=1,za.addEventListener("click",
HAniS.toggleLoopRock,!1),l.appendChild(za));"extrap"==p&&(ra=A("button"),ra.className="extrap",nb(ra,"extrap","Enable Extrap","Disable Extrap",n),ra.addEventListener("click",HAniS.toggleExtrap,!1),l.appendChild(ra));Y(p,"location")&&(ib=A("button"),ib.className="location",nb(ib,"location","Show Loc","Hide Loc",n),0<p.indexOf("/on")?(ib.innerHTML=ib.label_off,Mb=!0):Mb=!1,ib.addEventListener("click",function(){Mb=!Mb;ib.innerHTML=Mb?ib.label_off:ib.label_on},!1),l.appendChild(ib));"distance"==p&&(ta=
A("button"),ta.className="distance",nb(ta,"distance","Show dist","Hide dist",n),hb=Zc=!1,ta.addEventListener("click",function(){hb=!hb;ta.innerHTML=hb?ta.label_off:ta.label_on},!1),l.appendChild(ta));"probe"==p&&(yb=A("button"),yb.className="probe",nb(yb,"probe","Show probe","Hide probe",n),Ob=wd=!1,se="Undefined",Bc=0,null!=c.probe_undefined&&(k=c.probe_undefined.split(","),se=k[0].trim(),1<k.length&&(Bc=parseInt(k[1],10)+1)),yb.addEventListener("click",function(){(wd=!wd)?(yb.innerHTML=yb.label_off,
Ob=!0):(yb.innerHTML=yb.label_on,Ob=!1)},!1),l.appendChild(yb));"refresh"==p&&(zc=A("button"),zc.className="refresh",nb(zc,"refresh","Refresh",null,n),zc.addEventListener("click",HAniS.reloadFOF,!1),l.appendChild(zc));"setframe"==p&&(Ra=A("input"),Ra.className="setframe",Ra.type="range",Ra.min=0,Ra.max=99,Ra.value=0,ud="Frame #*",null!=c.setframe_label&&(ud=c.setframe_label),Wc=A("span"),Wc.innerHTML=ud.replace("*",1),h="display:block;vertical-align:middle;"+c.setframe_style,Ra.setAttribute("style",
h),k=A("span"),k.setAttribute("style","display:inline-block;vertical-align:top;"),Wc.setAttribute("style","display:block;vertical-align:middle;"+c.setframe_label_style),k.appendChild(Wc),k.appendChild(Ra),l.appendChild(k),Ra.addEventListener("input",function(a){Ea(!1);Ec(parseInt(Ra.value,10));Wc.innerHTML=ud.replace("*",C+1);ua()},!1),de=!0);"framelabel"==p&&(Ia=A("button"),Ia.className="framelabel",Ia.innerHTML="",xa=null,null!=c.frame_labels&&(xa=c.frame_labels.split(","),Ia.innerHTML=xa[0]),h=
Na+c.framelabel_style,null!=h&&Ia.setAttribute("style",h),l.appendChild(Ia));if("autorefresh"==p||"autorefresh/off"==p)null!=Sb&&clearInterval(Sb),La=A("button"),La.className="autorefresh",nb(La,"autorefresh","Disable Auto Refresh","Enable Auto Refresh",n),La.addEventListener("click",HAniS.toggleAutoRefresh,!1),Cc=!1,l.appendChild(La),"autorefresh"==p?HAniS.toggleAutoRefresh():La.innerHTML=La.label_off;"step"==p&&(k=c.step_labels,k=null!=k?k.split(","):["<",">"],Jb=A("button"),Jb.className="step back",
Jb.innerHTML=k[0],Jb.addEventListener("click",function(){Ea(!1);fd(-1);ua()},!1),h=Na+c.step_style,null!=h&&Jb.setAttribute("style",h),null!=n&&(Jb.title=n),l.appendChild(Jb),Ib=A("button"),Ib.className="step forward",Ib.innerHTML=k[1],Ib.addEventListener("click",function(){Ea(!1);fd(1);ua()},!1),null!=h&&Ib.setAttribute("style",h),null!=n&&(Ib.title=n),l.appendChild(Ib));"firstlast"==p&&(k=c.firstlast_labels,k=null!=k?k.split(","):["<<",">>"],Ha=A("button"),Ha.className="firstlast",Ha.innerHTML=
k[0],Ha.addEventListener("click",function(){Ea(!1);Ec(0);ua()},!1),h=Na+c.firstlast_style,null!=h&&Ha.setAttribute("style",h),null!=n&&(Ha.title=n),l.appendChild(Ha),Ua=A("button"),Ua.className="firstlast",Ua.innerHTML=k[1],Ua.addEventListener("click",function(){Ea(!1);Ec(u-1);ua()},!1),null!=h&&Ua.setAttribute("style",h),null!=n&&(Ua.title=n),l.appendChild(Ua));"setspeed"==p?(Pa=A("input"),Pa.className="setspeed",Pa.type="range",Pa.min=$a,Pa.max=Eb,Pa.value=Eb-ka,null!=n&&(Pa.title=n),h="vertical-align:middle;"+
c.setspeed_style,Pa.setAttribute("style",h),Pa.addEventListener("input",function(a){ka=Eb-parseInt(Pa.value,10)+30;Ea(!0);ua()},!1),l.appendChild(Pa)):"speed"==p&&(k=c.speed_labels,k=null!=k?k.split(","):["-","+"],gb=A("button"),gb.className="speed slower",gb.innerHTML=k[0],gb.addEventListener("click",function(){ka+=hd;fb.disabled=!1;ka>Eb&&(ka=Eb,gb.disabled=!0)},!1),h=Na+c.speed_style,null!=h&&gb.setAttribute("style",h),null!=n&&(gb.title=n),l.appendChild(gb),fb=A("button"),fb.className="speed faster",
fb.innerHTML=k[1],fb.addEventListener("click",function(){ka-=hd;gb.disabled=!1;ka<$a&&(ka=$a,fb.disabled=!0)},!1),null!=h&&fb.setAttribute("style",h),null!=n&&(fb.title=n),l.appendChild(fb));"zoom"==p&&(Ka=A("button"),Ka.className="zoom off",nb(Ka,"zoom","Zoom","Un-zoom",n),Ka.addEventListener("click",HAniS.toggleZooming,!1),l.appendChild(Ka));"show"==p&&(Tc=A("button"),Tc.className="show",nb(Tc,"show","Show","Show",n),sd=c.show_prompt,null==sd&&(sd="Right-click to save or copy the image<br> <font size='-1'>(to save in some browsers, you may need to first 'Open in New Tab')</font> <p>"),
Tc.addEventListener("click",function(){var a=ja.toDataURL();window.open().document.write(sd+"<img src="+a+"></img>")},!1),l.appendChild(Tc));"toggle"==p&&(lc=[],k=c.toggle_size,null!=k?(k=k.split(","),Wb=parseInt(k[0],10),Kc=parseInt(k[1],10),Lc=parseInt(k[2],10)):(Kc=Wb=10,Lc=3),Pd="red",Qd="blue",Rd="orange",k=c.toggle_colors,null!=k&&(k=k.split(","),Qd=k[0].trim(),Pd=k[1].trim(),Rd=k[2].trim()),rb=A("div"),rb.setAttribute("style","position:relative;border:0px;margin:0px;padding:0px;-webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; -webkit-tap-heightlight-color:transparent;"),
rb.style.backgroundColor=l.style.backgroundColor,rb.align=Dc,Od=new PEvs(rb,null,null,null,null,HAniS.togclick,null),Oc=A("canvas"),Oc.height=2*Kc,Ud=Oc.getContext("2d"),rb.appendChild(Oc),b?X.insertBefore(rb,ea):X.appendChild(rb),k=c.toggle_onoff,Nc=null,null!=k&&(Nc=k.split(",")),Mc=!0,null!=n&&(rb.title=n));if("overlay"==p){q=[];p=c.overlay_tooltip;n=null;null!=p&&(n=p.split(","));p=c.overlay_radio;k=null;null!=p&&(k=p.split(","));var N=c.overlay_labels_color,h=null;null!=N&&(h=N.split(","));hc=
[];d=c.overlay_caching;N=null;null==d&&(d=c.overlay_static);null!=d&&(N=d.split(","));var V=!0;null!=c.overlay_nonewdiv&&(V=!1);for(d=0;d<g.length;d++){var K=g[d].trim();if(0==d||0==K.indexOf("/"))0==K.indexOf("/")&&(K=K.substr(1)),V?(s=A("div"),s.align="center",b?X.insertBefore(s,ea):X.appendChild(s)):(s=A("span"),l.appendChild(s)),null!=c.overlay_labels_style&&s.setAttribute("style",c.overlay_labels_style);var M=!1,P=K.length;0<K.indexOf("/on")&&K.indexOf("/on")==P-3&&(M=!0,K=K.substr(0,P-3));var R=
!1;0<K.indexOf("/always")&&K.indexOf("/always")==P-7&&(R=M=!0);var W=!1;0<K.indexOf("/hidden")&&K.indexOf("/hidden")==P-7&&(W=!0);null!=N?Y(N[d],"y")||Y(N[d],"t")?hc[d]=!0:hc[d]=!1:hc[d]=!0;q[d]=A("input");q[d].type="checkbox";q[d].value=K;P="vertical-align:middle;";null!=c.checkbox_style&&(P+=c.checkbox_style);q[d].setAttribute("style",P);q[d].checked=M;q[d].name=0;null!=la&&d==qb&&q[d].checked&&(la.disabled=!1);null!=sb&&!sb[d]&&M&&(Xb=!1);q[d].addEventListener("click",HAniS.overClick,!1);null!=
p&&(M=k[d].indexOf("/"),-1!=M&&(q[d].name=k[d].substr(M+1).trim()),-1!=k[d].indexOf("true")&&(q[d].type="radio",-1==M&&(q[d].name="all")));q[d].isGhost=!0;R||W||(null!=n&&(q[d].title=n[d]),R=A("label"),R.htmlFor=K,null!=n&&(R.title=n[d]),R.appendChild(document.createTextNode(K)),K="vertical-align:middle;",null!=h&&(K=K+"color:"+h[d]+";"),R.setAttribute("style",K),K=A("span"),W="10",null!=Pc&&(W=10+Pc[d]),K.setAttribute("style","margin-left:"+W+"px;"),K.appendChild(q[d]),K.appendChild(R),s.appendChild(K),
q[d].isGhost=!1)}if(null==Ya)for(Ya=Array(g.length),d=0;d<g.length;d++)Ya[d]=0;else for(d=0;d<g.length;d++)Fe(d)}}},Fe=function(a){var b,e;if(0>Ya[a]){e=!1;for(b=0;b<g.length;b++)Ya[b]!=-Ya[a]||e||(e=q[b].checked);q[a].checked=e}},hf=function(a){0==bb&&(Hb=[]);a=a.split("=")[1].split(",");var b=a[4].trim(),e=a[4].indexOf("/"),d=-1;-1!=e&&(d=parseInt(a[4].substring(e+1),10)-1,b=b.substring(0,e));Hb[bb]=new Dd(parseInt(a[0].trim(),10),parseInt(a[1].trim(),10),a[2].trim(),a[3].trim(),b.toLowerCase(),
a[5].trim().toLowerCase(),a[6].trim(),d,8==a.length?a[7].trim():null);bb+=1},gf=function(a){0==mc&&(na=[],V=null);var b=a.split("=")[1].split("(");a=b[0].split(",");var e=a[0].trim();0==e.indexOf("0x")&&(e="#"+e.substring(2));na[mc]=new W(e,a[1].trim(),a[2].trim(),a[3].trim(),b[1].trim());mc+=1},af=function(a){0==va&&(ga=[]);a=a.split("=")[1].split(",");ga[va]=new Cd(parseInt(a[0],10)-1,parseInt(a[1],16),a[2].trim(),a[3].trim(),5==a.length?a[4].trim():"Click for details");va+=1};this.drag=function(a){M=
I.getX();N=I.getY();s=M*z;w=N*J;Kb=Oa=!1;hb&&(!Zc||Zc&&a.shiftKey)?(wc=s,xc=w,Kb=!0):(xb&&G!=Uc?(H=(aa*x-s)/x,B=(ba*G-w)/G,0>H&&(H=0),B<ed&&(B=ed),H+qa>ia&&(H=ia-qa),B+ca>E-dc&&(B=E-dc-ca),H=Math.round(H),B=Math.round(B),aa=Math.round(H+s/x),ba=Math.round(B+w/G)):!sa&&cb&&(V=null,Xb&&0<=s&&0<=w&&(t=nc.getImageData(s,w,1,1).data,0!=t[3]&&(V=na[t[3]-1]))),Vc=!0,ua());Fa()};var Ge=function(){if(oc){da=-1;for(var a=0;a<wa.length;a++)x>=wa[a]&&(da=a)}},Ie=function(a,b){"popup"==a.action?(null!=Va&&Va.close(),
Va=window.open("","HAniSPopup","scrollbars=yes,width="+qe+",height="+re),Va.document.write(pe+a.value+"</div>")):"link"==a.action?window.open(a.value,"_blank",""):"fof"==a.action&&(L=Id,HAniS.resetZoom(),HAniS.newFOF(a.value),Ze(b))};this.resetZoom=function(){x=td;G=Uc;null!=Ka&&(Ka.innerHTML=Ka.label_on,xb=!1);aa=s;ba=w;B=H=0;ca=E;qa=ia;Ge();ua();md&&(cb=!0)};this.canTip=function(){var a;Oa=!1;M=I.getX();s=M*z;N=I.getY();w=N*J;if(!(sa&&w<Xd&&s>Vd)){aa=Math.round(H+s/x);ba=Math.round(B+w/G);if(0!=
va)for(a=0;a<va;a++)if(ga[a].overlay>=Q)O(" Error...hotzone overlay # "+ga[a].overlay+" > number of overlays = "+Q);else if(q[ga[a].overlay].checked&&(S.clearRect(0,0,1,1),S.drawImage(T[C][ga[a].overlay],aa,ba,1,1,0,0,1,1),t=S.getImageData(0,0,1,1).data,ld=(t[0]<<16)+(t[1]<<8)+t[2],ld==ga[a].color)){Oa=!0;Kd=M;Ld=N;Jd=ga[a].tip;break}if(0!=bb){var b,e,d,c;for(a=0;a<bb;a++)if(c=Hb[a],-1==c.overlay||q[c.overlay].checked)if(d=!1,c.isPan?c.isIcon?(b=(c.x0-H)*x-c.w2,e=(c.y0-B)*G-c.h2,s>b&&s<b+c.width&&
w>e&&w<e+c.height&&(d=!0)):(b=(c.x0-H)*x,e=(c.y0-B)*G,s>b&&s<b+c.width*x&&w>e&&w<e+c.height*G&&(d=!0)):s>c.x0&&s<c.x1&&w>c.y0&&w<c.y1&&(d=!0),d&&null!=c.tip){Oa=!0;Kd=M;Ld=N;Jd=Hb[a].tip;break}}Fa()}};this.move=function(){if(!sa&&cb&&(V=null,Xb)){var a=I.getX()*z,b=I.getY()*J;0<=a&&0<=b&&(t=nc.getImageData(a,b,1,1).data,0!=t[3]&&(V=na[t[3]-1]))}sa&&2<=oa&&(M=I.getX(),s=M*z,N=I.getY(),w=N*J);Fa()};this.down=function(){Oa&&(Oa=!1,Fa());M=I.getX();s=M*z;N=I.getY();w=N*J;Xc=s;Yc=w;wc=Xc;xc=Yc;aa=Math.round(H+
s/x);ba=Math.round(B+w/G);Vc=!1};this.up=function(a){Oa=!1;if(sa){M=I.getX();s=M*z;N=I.getY();w=N*J;if(3>oa)if(Qa[oa]=s,Ja[oa]=w,Zb[oa]=qd[C],0==oa)oa=1,Ec(u-1),Rc=1,cc=null;else{Yd=Zb[1]-Zb[0];Qc=(Qa[1]-Qa[0])/Yd;qc=(Ja[1]-Ja[0])/Yd;if(null!=xd&&null!=Lb){var b=Qc*Lb,e=qc*$c,d=Math.round(60*Math.sqrt(b*b+e*e)),b=Math.atan2(b,-e)/.0174533;0>b&&(b+=360);cc=te+df[Math.round(b/22.5)]+" at "+d+" "+ue;Te=Qa[0];Ue=0<qc?Ja[0]-15:Ja[0]+30}d=parseInt(tc,10);r=Math.round(Math.abs(4*(d+4)/Qc));$b=Math.round(Math.abs(2*
(d+4)/qc));$b<r&&(r=$b);120<r?r=120*Math.floor(r/120)+60:90<r?r=120:60<r?r=90:30<r?r=60:15<r?r=30:10<r?r=15:5<r?r=10:2<r?r=5:0==r&&(r=1);$b=Zb[1]/r*r+r;pc=1;be&&(pc=-1);Zd=Qc*r;rd=qc*r;Ec(u-1);oa=3;Rc=2}else if(w<Xd&&s>Vd&&3==oa){cf();Fa();return}Fa()}if(Kb)Kb=!1,Fa();else if(null!=ta&&xb&&(hb=!1,ta.innerHTML=ta.label_on),Vc)Vc=!1;else if(a.altKey)HAniS.resetZoom();else if(cb&&null!=V&&od)Ie(V,"z");else{M=I.getX();s=M*z;N=I.getY();w=N*J;if(0!=va)for(d=0;d<va;d++)if(ga[d].overlay>=Q)O(" Error...hotzone overlay # "+
ga[d].overlay+" > number of overlays = "+Q);else if(q[ga[d].overlay].checked&&(S.clearRect(0,0,1,1),S.drawImage(T[C][ga[d].overlay],Math.floor(aa),Math.floor(ba),1,1,0,0,1,1),t=S.getImageData(0,0,1,1).data,ld=(t[0]<<16)+(t[1]<<8)+t[2],ld==ga[d].color)){Ie(ga[d],"z");return}if(0!=bb)for(var c,f,d=0;d<bb;d++)if(f=Hb[d],-1==f.overlay||q[f.overlay].checked)if(c=!1,f.isPan?f.isIcon?(b=(f.x0-H)*x-f.w2,e=(f.y0-B)*G-f.h2,s>b&&s<b+f.width&&w>e&&w<e+f.height&&(c=!0)):(b=(f.x0-H)*x,e=(f.y0-B)*G,s>b&&s<b+f.width*
x&&w>e&&w<e+f.height*G&&(c=!0)):s>f.x0&&s<f.x1&&w>f.y0&&w<f.y1&&(c=!0),c){Ie(Hb[d],"s");return}xb&&(cb=!1,a.ctrlKey?(x-=.1*uc,G-=.1*uc):(x+=.1*uc,G+=.1*uc,x>vc&&(x=vc),G>vc&&(G=vc)),x<td||G<Uc?(x=td,G=Uc,aa=s,ba=w,B=H=0,ca=E,qa=ia,ed=dc=0):(H=(aa*x-s)/x,B=(ba*G-w)/G,ca=Math.floor(E/G),B+ca>E-dc&&(B=E-dc-ca),qa=Math.floor(ia/x),B=Math.round(B),H=Math.round(H),dc=Be,ed=Ce),Ge());ua();Fa()}};this.toggleAutoRefresh=function(){Cc?(La.innerHTML=La.label_off,null!=Sb&&clearInterval(Sb),Cc=!1):(La.innerHTML=
La.label_on,Sb=setInterval("HAniS.reloadFOF();",Ad),Cc=!0)};this.toggleLoopRock=function(){ic?(null!=za&&(za.innerHTML=za.label_on,za.className="looprock rock"),ic=!1):(null!=za&&(za.innerHTML=za.label_off,za.className="looprock loop"),ic=!0)};this.toggleExtrap=function(){sa?(null!=ra&&(ra.innerHTML=ra.label_on,X.style.cursor="default",null!=Z&&(Z.disabled=!1),Ea(pb),oa=-1),sa=!1,Fa()):(null!=ra&&(sa=!0,cc=null,X.style.cursor="crosshair",ra.innerHTML=ra.label_off,pb=Za,null!=Z&&(Z.disabled=!0),Za=
!1,HAniS.resetZoom(),cf(),Fa()),ua())};var cf=function(){Rc=0;Qa=Array(2);Ja=Array(2);Zb=Array(2);oa=0;cc=null;Ec(0)},Ea=function(a){Za=!a;HAniS.toggleIsLooping()};this.doEnhance=function(a){if(Vb||Fb){var b=ma[0].height,c=ma[0].width;a=parseInt(la.value,10);var d,f,g,q;0<=a&&(d=Ba[a],f=Ca[a],g=Da[a],q=bd[a],Ac[qb]=a);for(var c=b*c*4,h=0;h<ab.length;h++)if(ma[h].gotit){ma[h].gotit=!1;var m=Jc[h].data,r=jd[h];if(0>a)for(var n=0;n<c;n+=4)m[n]=r[n],m[n+1]=r[n+1],m[n+2]=r[n+2],m[n+3]=r[n+3];else for(n=
0;n<c;n+=4)b=r[n],b===r[n+1]&&b===r[n+2]&&(m[n]=d[b],m[n+1]=f[b],m[n+2]=g[b],m[n+3]=q[b]);Gb[h].putImageData(Jc[h],0,0);ma[h].gotit=!0}}};this.overClick=function(a){var b;if(a.target.checked)for(b=0;b<q.length;b++)a.target!=q[b]&&0!=a.target.name&&a.target.name==q[b].name&&(q[b].checked=!1);Xb=!0;for(b=0;b<Ya.length;b++)a.target!=q[b]&&Fe(b),null!=sb&&!sb[b]&&q[b].checked&&(Xb=!1),null!=la&&b==qb&&(la.disabled=!q[b].checked);ua()};this.toggleIsLooping=function(){Za?(Za=!1,null!=Z&&(Z.className="startstop start",
Z.innerHTML=Z.label_on)):(Za=!0,null!=Z&&(Z.className="startstop stop",Z.innerHTML=Z.label_off))};this.toggleZooming=function(){xb?(HAniS.resetZoom(),Ka.className="zoom off"):(Ka.innerHTML=Ka.label_off,Ka.className="zoom on",xb=!0,null!=ta&&(hb=!1,ta.innerHTML=ta.label_on),cb=!1,sa&&HAniS.toggleExtrap())};var ec=function(a,b){lc[a]=b;if(Mc){var c=Nd+a*(Wb+Lc),d=Rd;0==b?d=Qd:-1==b&&(d=Pd);Ud.fillStyle=d;Ud.fillRect(c,Kc/2,Wb,Kc)}};this.togclick=function(a){var b=Od.getX();Od.getY();var c=Nd;for(a=
0;a<lc.length;a++){if(b>c&&b<c+Wb){b=0;0<=lc[a]&&(b=-1);ec(a,b);break}c=c+Wb+Lc}};var jf=function(a){Mc&&(Oc.width=D,Nd=D/2-a*(Wb+Lc)/2);for(var b=0;b<a;b++)null!=Nc&&"n"==Nc[b].toLowerCase().trim()?ec(b,-1):ec(b,0)},Ec=function(a){ec(C,0);C=a;ec(C,1);null!=Ia&&null!=xa&&null!=xa[C]&&(Ia.innerHTML=xa[C])},fd=function(a){ec(C,0);do 0<a?(C+=1,C>=u&&(ic?(C=u-1,Db=-Db):C=0)):(C-=1,0>C&&(ic?(C=0,Db=-Db):C=u-1)),a=Db;while(0>lc[C]);ec(C,1);null!=Ia&&null!=xa&&null!=xa[C]&&(Ia.innerHTML=xa[C])},fc=function(a,
b,c,d,g){f.globalAlpha=1;f.font=a.font;var l=a.fontHeight;c=c-l-6;var m=f.measureText(d).width;1==g&&(b-=m);0==g&&(b-=m/2);5>b&&(b=5);5>c&&(c=5);c+l+3>F&&(c=F-l-6);b+3+m>D&&(b=D-m-6);f.save();f.beginPath();f.fillStyle=a.bg;null!=a.scolor&&(f.shadowColor=a.scolor,f.shadowBlur=a.sblur,f.shadowOffsetX=a.sxoff,f.shadowOffsetY=a.syoff);fe=b-3;Me=c;Ne=m+6;ge=l+6;f.fillRect(fe,Me,Ne,ge);f.closePath();f.restore();f.textBaseline="bottom";f.fillStyle=a.fg;f.fillText(d,b,c+l+3)},Fa=function(){f.clearRect(0,
0,D,F);od=!1;if(sa){f.beginPath();f.lineWidth=2;f.strokeStyle="white";var a=oa;1<a&&(a=2);for(var b=0;b<a;b++)1<oa&&(f.moveTo(Qa[0],Ja[0]),f.lineTo(Qa[1],Ja[1])),f.moveTo(Qa[b]-15,Ja[b]),f.lineTo(Qa[b]+15,Ja[b]),f.moveTo(Qa[b],Ja[b]-15),f.lineTo(Qa[b],Ja[b]+15);f.closePath();f.stroke();if(3==oa){var c=M,d=N;f.moveTo(c,d);f.fillStyle=wb;f.fillRect(c-2,d-2,5,5);for(var b=$b,a=Math.round(c+pc*Qc*($b-Zb[1])),g=Math.round(d+pc*qc*($b-Zb[1])),l=0;300>l;l++){f.beginPath();f.lineWidth=1;f.strokeStyle=wb;
f.moveTo(c,d);f.lineTo(a,g);f.stroke();f.beginPath();f.lineWidth=3;f.rect(a-2,g-2,5,5);f.stroke();if(3>a||a+3>D||3>g||g+3>F)break;d=ya+b;d=100*Math.floor(d/60)+d%60;d%=2400;ae?(c="AM",1200<=d?(1300<=d&&(d-=1200),c="PM"):100>d&&(d+=1200),c=Math.floor(d/100)+":"+Math.floor(Math.floor(d%100)/10)+Math.floor(d%10)+" "+c):(c=d+" ",1E3>d&&(c="0"+d),100>d&&(c="00"+d),10>d&&(c="000"+d));d=0;Math.abs(rd)<ac+5&&(d=45*.0174533);var m=g;0>Zd*rd&&0==d&&(m=g+ac);f.font=tc;var c=c+" "+$d,h=f.measureText(c).width;
f.fillStyle=sc;0===d?(f.fillRect(a+2,m-ac-2+d,h+4,ac+3),f.fillStyle=wb,f.textBaseline="bottom",f.fillText(c,a+5,m)):(f.save(),f.translate(a+5,g),f.rotate(d),f.fillRect(2,-2,h+4,ac+3),f.fillStyle=wb,f.textBaseline="bottom",f.fillText(c,5,ac),f.restore());c=a;d=g;a=Math.round(c+pc*Zd);g=Math.round(d+pc*rd);b+=r}}null!=cc&&fc(xd,Te,Ue,cc,0);fc(Le,999,10,Wd[Rc],0);Vd=fe;Xd=ge}Kb&&(b=Lb*(Xc-wc)/x,a=$c*(Yc-xc)/G,b=" "+Math.sqrt(b*b+a*a).toFixed(ee)+" "+ie+" ",fc(Oe,wc/z,xc/J,b,-1),f.beginPath(),f.strokeStyle=
he,f.lineWidth=3,f.moveTo(Xc/z,Yc/J),f.lineTo(wc/z,xc/J),f.stroke(),f.closePath());Oa&&fc(je,Kd,Ld,Jd,-1);if(Ob||Mb)if(M=I.getX(),s=M*z,N=I.getY(),w=N*J,0<=s&&0<=w){aa=H+s/x;ba=B+w/G;if(Mb){null!=jb?yc=jb.toLatLon(aa,ba):(yc[0]=ne+(Qe-ne)*ba/E,yc[1]=oe+(Re-oe)*aa/ia);Pe=ke+yc[0].toFixed(vd)+"  "+le+yc[1].toFixed(vd);b=N;if(Kb||Oa)b=N+me.fontHeight+6;fc(me,M+10,b,Pe,-1)}if(Ob)for(aa=Math.round(aa),ba=Math.round(ba),a=0;a<Q;a++)if(T[C][a].gotit&&q[a].checked&&(a==qb||null!=Ac[a]&&0<=Ac[a])){S.clearRect(0,
0,1,1);a==qb?S.drawImage(ab[C],aa,ba,1,1,0,0,1,1):S.drawImage(T[C][a],aa,ba,1,1,0,0,1,1);t=S.getImageData(0,0,1,1).data;ad=999;y=Ac[a];g=se;if(0==t[3])g=ze[y];else{if(a==qb)ve=0,zb=t[0],ad=0;else for(b=0;b<Aa[y].length-1;b++)mb[0]=t[0]-Ba[y][b],0>mb[0]*(Ba[y][b+1]-t[0]-1)||(mb[1]=t[1]-Ca[y][b],0>mb[1]*(Ca[y][b+1]-t[1]-1)||(mb[2]=t[2]-Da[y][b],0>mb[2]*(Da[y][b+1]-t[2]-1)||(bc=zd[y][b],yd=mb[bc]/Rb[y][b][bc],ye=Math.abs(mb[we[bc]]-yd*Rb[y][b][we[bc]])+Math.abs(mb[xe[bc]]-yd*Rb[y][b][xe[bc]]),ye<ad&&
(zb=b,ad=ye,ve=yd))));if(999>ad)g=Qb[y][zb],-1!=lb[y][zb]&&(g=g+" "+(Aa[y][zb]+ve*(Aa[y][zb+1]-Aa[y][zb])).toFixed(lb[y][zb])+" "+Pb[y][zb]);else if(1<Bc){for(b=0;b<Aa[y].length-1;b++)if(Math.abs(t[0]-Ba[y][b])<Bc&&Math.abs(t[1]-Ca[y][b])<Bc&&Math.abs(t[2]-Da[y][b])<Bc){g=Qb[y][b];-1!=lb[y][b]&&(g=g+" "+Aa[y][b].toFixed(lb[y][b])+" "+Pb[y][b]);break}O("RGB err: R="+t[0]+" G="+t[1]+" B="+t[2])}}fc(Se,M-10,N,g,1)}}!cb||sa||hb||Ob||null==V||(f.drawImage(V.can,0,0,V.width,V.height,V.xmin/z,V.ymin/J,V.width/
z,V.height/J),fc(je,(V.xmin+V.xmax)/2/z,(V.ymin+V.ymax)/2/J,V.tip,0),od=!0)},ua=function(){var a;if(pd)try{v.clearRect(0,0,D,F);v.globalAlpha=1;if(oc&&null!=db&&0<=da&&db[da].gotit)v.drawImage(db[da],H*wa[da],B*wa[da],qa*wa[da],ca*wa[da],0,0,D,F);else if(pa[C].gotit&&v.drawImage(pa[C],H,B,qa,ca,0,0,D,F),null!=ha&&(v.globalAlpha=1,pa[C].gotit))for(var b=0;b<ha.length;b+=4)v.drawImage(pa[C],ha[b],ha[b+1],ha[b+2],ha[b+3],ha[b],ha[b+1],ha[b+2],ha[b+3]);if(0<Q){for(b=0;b<Q;b++)a=null!=Cb?Cb[b]:b,q[a].checked&&
(oc&&null!=eb&&0<=da&&eb[da].gotit&&Td==a?v.drawImage(eb[da],H*wa[da],B*wa[da],qa*wa[da],ca*wa[da],0,0,D,F):T[C][a].gotit&&(null!=Hc&&(v.globalAlpha=Hc[a]),null==Nb||1===Nb[a]?v.drawImage(T[C][a],H,B,qa,ca,0,0,D,F):0===Nb[a]&&v.drawImage(T[C][a],0,0,ia,E,0,0,D,F)));if(null!=kb)for(v.globalAlpha=1,b=0;b<Q;b++)a=null!=Cb?Cb[b]:b,T[C][a].gotit&&q[a].checked&&kb[a]&&v.drawImage(T[C][a],R[a][0],R[a][1],R[a][2],R[a][3],R[a][0],R[a][1],R[a][2],R[a][3]);Ob&&Fa()}Ae&&gd();if(Hd){v.globalAlpha=1;var c;for(a=
0;a<bb;a++)c=Hb[a],null!=c.icon&&c.icon.gotit&&(c.isPan?v.drawImage(c.icon,0,0,c.width,c.height,((c.x0-H)*x-c.w2)/z,((c.y0-B)*G-c.h2)/J,c.width/z,c.height/J):v.drawImage(c.icon,0,0,c.width,c.height,c.x0/z,c.y0/J,c.width/z,c.height/z))}}catch(d){O("Error:"+d)}},gd=function(){if(Bd&&Tb>Ma){v.save();v.fillStyle="blue";v.strokeStyle="white";v.lineWidth=3;v.strokeRect(cd,dd,200,14);v.fillRect(cd,dd,Ma/Tb*200,14);var a=v.measureText("Loading images").width;v.fillStyle="orange";v.font="14px arial";v.fillText("Loading images",
cd+100-a/2,dd+11);v.restore()}else Ae=!1},O=function(a){if(ob&&Wa&&!Wa.closed)try{Wa.document.write(a+"<br>")}catch(b){}},bf=function(){Za&&fd(Db);Ke=C==u-1?Md+ka:ka;ua();setTimeout(function(){ef(bf)},Ke)},Fc=function(a){for(;-180>a;)a+=360;for(;180<a;)a-=360;return a}};
